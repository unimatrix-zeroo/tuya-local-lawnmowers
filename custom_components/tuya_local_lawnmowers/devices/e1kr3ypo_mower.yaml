name: Generic Tuya mower (modelId e1kr3ypo)
product_ids:
  - e1kr3ypo

entities:
  # --- HA lawn_mower (Haupt-Entity) ---
  - entity: lawn_mower
    icon: mdi:robot-mower
    dps:
      # Aktivität/Zustand
      - id: 101
        type: enum
        name: activity
        mapping:
          - dps_val: STANDBY
            value: docked
          - dps_val: CHARGING
            value: docked
          - dps_val: CHARGING_WITH_TASK_SUSPEND
            value: docked
          - dps_val: PARK
            value: docked
          - dps_val: MOWING
            value: mowing
          - dps_val: FIXED_MOWING
            value: mowing
          - dps_val: PAUSED
            value: paused
          - dps_val: ERROR
            value: error
          - dps_val: EMERGENCY
            value: error
          - dps_val: LOCKED
            value: error

      # Steuerbefehle (wird von commands unten verwendet)
      - id: 115
        type: enum
        name: command

    # Lawn-mower Kommandos -> DP115
    commands:
      start:
        dps: 115
        value: StartMowing
      pause:
        dps: 115
        value: PauseWork
      resume:
        dps: 115
        value: ContinueWork
      dock:
        dps: 115
        value: StartReturnStation
      stop:
        dps: 115
        value: CancelWork

    # Optionaler Zusatzservice (Fixpunkt-Mähen)
    services:
      start_fixed_mowing:
        dps: 115
        value: StartFixedMowing

  # --- Batterie ---
  - entity: sensor
    name: Battery
    device_class: battery
    unit_of_measurement: "%"
    dps:
      - id: 6
        type: integer
        name: battery

  # --- Problem (Bitfeld) ---
  - entity: binary_sensor
    name: Problem
    device_class: problem
    dps:
      - id: 102
        type: bitfield
        name: fault

  # --- Warnung (enum) ---
  - entity: sensor
    name: Warning
    icon: mdi:alert-circle
    dps:
      - id: 103
        type: enum
        name: warning

  # --- Deckelkontakt ---
  - entity: binary_sensor
    name: Cover
    device_class: opening
    dps:
      - id: 116
        type: boolean
        name: open
        mapping:
          - dps_val: true
            value: on
          - dps_val: false
            value: off

  # --- Regenmodus ---
  - entity: switch
    name: Rain mode
    icon: mdi:weather-rainy
    dps:
      - id: 104
        type: boolean
        name: switch

  # --- Arbeitszeit (h) ---
  - entity: number
    name: Work time
    icon: mdi:timer-cog
    dps:
      - id: 105
        type: integer
        name: value
        unit: h
        range: { min: 1, max: 99 }
        step: 1

  # --- PIN (1111–4444), als Config ---
  - entity: number
    name: PIN code
    entity_category: config
    icon: mdi:form-textbox-password
    dps:
      - id: 106
        type: integer
        name: value
        range: { min: 1111, max: 4444 }

  # --- Plan/Partition Buttons (schreibend, pulsend) ---
  - entity: button
    name: Clear schedule
    entity_category: config
    icon: mdi:calendar-remove
    dps:
      - id: 107
        type: boolean
        name: button
        payload_on: true

  - entity: button
    name: Query schedule
    entity_category: diagnostic
    icon: mdi:calendar-search
    dps:
      - id: 108
        type: boolean
        name: button
        payload_on: true

  - entity: button
    name: Query partitions
    entity_category: diagnostic
    icon: mdi:map-search
    dps:
      - id: 109
        type: boolean
        name: button
        payload_on: true

  # --- Fehler-/Arbeits-Logs als Roh-/Stringdaten ---
  - entity: sensor
    name: Error log
    entity_category: diagnostic
    icon: mdi:file-alert
    dps:
      - id: 111
        type: string
        name: value

  - entity: sensor
    name: Work log
    entity_category: diagnostic
    icon: mdi:book-clock
    dps:
      - id: 112
        type: string
        name: value

  # --- Partitionen (Roh) ---
  - entity: sensor
    name: Partitions
    entity_category: diagnostic
    icon: mdi:grid
    dps:
      - id: 113
        type: string
        name: value

  # --- „Hedgehog“-Schutz ---
  - entity: switch
    name: Hedgehog protection
    icon: mdi:shield-sun
    dps:
      - id: 118
        type: boolean
        name: switch

  # --- Firmware ---
  - entity: sensor
    name: Firmware
    icon: mdi:chip
    dps:
      - id: 134
        type: string
        name: value

  # --- Rain delay raw (Byte1: on/off, Byte2: delay) ---
  - entity: sensor
    name: Rain delay (raw)
    entity_category: diagnostic
    icon: mdi:weather-pouring
    dps:
      - id: 139
        type: raw
        name: value
