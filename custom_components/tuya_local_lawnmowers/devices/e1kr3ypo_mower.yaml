name: Tuya Mower e1kr3ypo

# WICHTIG: Der Parser erwartet "products" (nicht "product_ids")
products:
  - id: e1kr3ypo

entities:

  # Haupt-Entity (HA lawn_mower)
  - entity: lawn_mower
    icon: mdi:robot-mower
    dps:
      # AktivitÃ¤t/Zustand -> string
      - id: 101
        type: string
        name: activity
        mapping:
          - dps_val: STANDBY
            value: docked
          - dps_val: CHARGING
            value: docked
          - dps_val: CHARGING_WITH_TASK_SUSPEND
            value: docked
          - dps_val: PARK
            value: docked
          - dps_val: CHARGE_DONE
            value: docked
          - dps_val: MOWING
            value: mowing
          - dps_val: FIXED_MOWING
            value: mowing
          - dps_val: PAUSED
            value: paused
          - dps_val: ERROR
            value: error
          - dps_val: EMERGENCY
            value: error
          - dps_val: LOCKED
            value: error

      # Steuerbefehle -> write-only, daher optional markieren!
      - id: 115
        type: string
        name: command
        optional: true

    commands:
      start:   { dps: 115, value: StartMowing }
      pause:   { dps: 115, value: PauseWork }
      resume:  { dps: 115, value: ContinueWork }
      dock:    { dps: 115, value: StartReturnStation }
      stop:    { dps: 115, value: CancelWork }
    services:
      start_fixed_mowing: { dps: 115, value: StartFixedMowing }

  # Batterie -> DP 13 (laut deinem Log)
  - entity: sensor
    name: Battery
    class: battery
    unit: "%"
    dps:
      - id: 13
        type: integer
        name: battery

  # Fehlerbits -> DP 102
  - entity: binary_sensor
    name: Problem
    class: problem
    dps:
      - id: 102
        type: bitfield
        name: fault
        optional: true

  # Warnung -> DP 103
  - entity: sensor
    name: Warning
    icon: mdi:alert
    dps:
      - id: 103
        type: string
        name: warning
        optional: true

  # Regenmodus -> DP 104
  - entity: switch
    name: Rain Mode
    icon: mdi:weather-rainy
    dps:
      - id: 104
        type: boolean
        name: switch

  # Arbeitszeit -> DP 105
  - entity: number
    name: Work Time
    icon: mdi:timer-cog
    dps:
      - id: 105
        type: integer
        name: value
        unit: h
        range: { min: 1, max: 99 }

  # PIN -> DP 106
  - entity: number
    name: PIN
    icon: mdi:form-textbox-password
    category: config
    dps:
      - id: 106
        type: integer
        name: value
        range: { min: 1111, max: 9999 }

  # Deckel -> DP 116
  - entity: binary_sensor
    name: Cover
    class: opening
    dps:
      - id: 116
        type: boolean
        name: open
        mapping:
          - dps_val: true
            value: on
          - dps_val: false
            value: off

  # Hedgehog -> DP 118
  - entity: switch
    name: Hedgehog Protection
    icon: mdi:shield
    dps:
      - id: 118
        type: boolean
        name: switch

  # Firmware -> DP 134
  - entity: sensor
    name: Firmware
    icon: mdi:chip
    dps:
      - id: 134
        type: string
        name: value
        optional: true
